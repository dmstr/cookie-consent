/* global Feature Scenario */

var assert = require('assert')

Feature('Cookie Consent')

Scenario('should work correctly', async function (I) {
  I.amOnPage('cookie-consent.html')
  I.dontSeeCookie('cookie_consent_status')
  I.dontSeeCookie('_ga')
  I.dontSeeCookie('_gat')
  I.dontSeeCookie('_gid')
  I.waitForElement('.cookie-consent-popup')
  I.dontSeeCheckboxIsChecked('[data-cc-consent="statistics"]')
  I.dontSeeCheckboxIsChecked('[data-cc-consent="extern-media"]')
  I.checkOption('[data-cc-consent="statistics"]')
  I.checkOption('[data-cc-consent="extern-media"]')
  I.click('.cookie-consent-save')
  I.seeCookie('cookie_consent_status')
  I.seeCookie('_ga')
  I.seeCookie('_gat')
  I.seeCookie('_gid')
  let cookie = await I.grabCookie('cookie_consent_status')
  assert.deepStrictEqual(cookie.value, '["statistics","extern-media"]')
  I.click('.cookie-consent-open')
  I.seeCheckboxIsChecked('[data-cc-consent="statistics"]')
  I.seeCheckboxIsChecked('[data-cc-consent="extern-media"]')
  I.uncheckOption('[data-cc-consent="statistics"]')
  I.uncheckOption('[data-cc-consent="extern-media"]')
  I.click('.cookie-consent-save')
  I.seeCookie('cookie_consent_status')
  I.dontSeeCookie('_ga')
  I.dontSeeCookie('_gat')
  I.dontSeeCookie('_gid')
  cookie = await I.grabCookie('cookie_consent_status')
  assert.deepStrictEqual(cookie.value, '[]')
  I.click('.cookie-consent-open')
  I.dontSeeCheckboxIsChecked('[data-cc-consent="statistics"]')
  I.dontSeeCheckboxIsChecked('[data-cc-consent="extern-media"]')
  I.click('.cookie-consent-close')
  I.waitForInvisible('.cookie-consent-popup')
  I.waitForInvisible('.cookie-consent-save')
  I.click('.cookie-consent-controls-open')
  I.waitForVisible('.cookie-consent-popup')
  I.waitForVisible('.cookie-consent-save')
  I.click('.cookie-consent-controls-close')
  I.waitForVisible('.cookie-consent-popup')
  I.waitForInvisible('.cookie-consent-save')
  I.click('.cookie-consent-accept-all')
  I.seeCookie('cookie_consent_status')
  I.seeCookie('_ga')
  I.seeCookie('_gat')
  I.seeCookie('_gid')
  cookie = await I.grabCookie('cookie_consent_status')
  assert.deepStrictEqual(cookie.value, '["statistics","extern-media"]')
  I.click('.cookie-consent-open')
  I.click('.cookie-consent-deny-all')
  I.seeCookie('cookie_consent_status')
  I.dontSeeCookie('_ga')
  I.dontSeeCookie('_gat')
  I.dontSeeCookie('_gid')
  cookie = await I.grabCookie('cookie_consent_status')
  assert.deepStrictEqual(cookie.value, '[]')
})
